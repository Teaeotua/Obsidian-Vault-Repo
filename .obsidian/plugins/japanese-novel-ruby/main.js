/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var U=(n,s)=>{for(var e in s)v(n,e,{get:s[e],enumerable:!0})},I=(n,s,e,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of F(s))!W.call(n,t)&&t!==e&&v(n,t,{get:()=>s[t],enumerable:!(o=O(s,t))||o.enumerable});return n};var G=n=>I(v({},"__esModule",{value:!0}),n);var Y={};U(Y,{RUBY_REGEXP:()=>m,RubyInsertModal:()=>f,default:()=>b});module.exports=G(Y);var l=require("obsidian");var H=n=>{var s;if(n.textContent){let e=Array.from(n.textContent.matchAll(m)),o=n;for(let t of e){let d=t.groups.ruby,i=(s=t.groups)!=null&&s.body1?t.groups.body1:t.groups.body2,a=document.createElement("ruby");if(a.addClass("ruby"),a.appendText(i),a.createEl("rt",{text:d}),o.textContent){let g=o.textContent.indexOf(t[0]),h=o.splitText(g);o=h.splitText(t[0].length),h.replaceWith(a)}}}return n},D=(n,s)=>{let e=n.querySelectorAll("p, h1, h2, h3, h4, h5, h6, ol, ul, table");if(e.length===0)return;function o(t){let d=[];t.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?d.push(i):i.hasChildNodes()&&i.nodeName!=="CODE"&&i.nodeName!=="RUBY"&&o(i)}),d.forEach(i=>{i.replaceWith(H(i))})}e.forEach(t=>{o(t)})};var _=require("@codemirror/view"),T=require("@codemirror/state"),p=require("obsidian");var x=class extends _.WidgetType{constructor(e,o){super();this.body=e;this.ruby=o}toDOM(e){let o=document.createElement("ruby");return o.appendText(this.body),o.createEl("rt",{text:this.ruby}),o}};function N(n,s){return _.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.updateDecorations(e),this.sourceModeRendering=s.settings.sourceModeRendering}update(e){(e.docChanged||e.viewportChanged||e.selectionSet||e.startState.field(p.editorLivePreviewField)!=e.state.field(p.editorLivePreviewField)||!e.startState.field(p.editorLivePreviewField)&&this.sourceModeRendering!=s.settings.sourceModeRendering)&&(this.sourceModeRendering!=s.settings.sourceModeRendering&&(this.sourceModeRendering=s.settings.sourceModeRendering),this.decorations=this.updateDecorations(e.view))}destroy(){}updateDecorations(e){return s.settings.sourceModeRendering||e.state.field(p.editorLivePreviewField)?this.buildDecorations(e):_.Decoration.none}buildDecorations(e){var d;let o=new T.RangeSetBuilder,t=[...e.state.selection.ranges];for(let i of e.visibleRanges){t.forEach(a=>{a.to>=i.from&&a.from<=i.to});for(let a=i.from;a<=i.to;){let g=e.state.doc.lineAt(a),h=Array.from(g.text.matchAll(m));for(let u of h){let k=!0,V=u.groups.ruby,B=(d=u.groups)!=null&&d.body1?u.groups.body1:u.groups.body2,w=u.index!=null?u.index+g.from:-1,S=w+u[0].length;t.forEach(C=>{C.to>=w&&C.from<=S&&(k=!1)}),k&&o.add(w,S,_.Decoration.widget({widget:new x(B,V)}))}a=g.to+1}}return o.finish()}},{decorations:e=>e.decorations})}var c=require("obsidian");var M=require("obsidian");var E={command_insert_novel_ruby:"Insert novel ruby",command_insert_novel_dot:"Insert novel emphasis dot",command_remove_novel_ruby:"Remove novel ruby from selection",ruby_insert_modal_title:"Insert ruby",ruby_insert_modal_body:"Body",ruby_insert_modal_ruby:"Ruby",ruby_insert_modal_ok:"OK",notice_insert_novel_dot_no_selection:"Selection is required to insert dots",settings_command_title:"Command",settings_support_title:"Support",settings_source_mode_render_name:"Enable ruby preview in source mode",settings_source_mode_render_desc:"Turn off if you want to display ruby marks as is in source mode.",settings_insert_full_width_separator_name:'Insert full-width "\uFF5C" by insert-ruby command',settings_insert_full_width_separator_desc:'Turn off if you want to insert half-width "|" by ruby insert dialog. Does not affect rendering.',settings_emphashis_dot_name:"Emphasis dot character",settings_emphashis_dot_desc:"A character for the emphasis dot. Only the first character will be saved.",settings_donate_name:"Donate",settings_donate_desc:"If you like this plugin, I would be grateful if you would consider making a donation to support development.",settings_donate_button:"Buy me a rice ball"};var A={command_insert_novel_ruby:"\u30EB\u30D3\u3092\u633F\u5165",command_insert_novel_dot:"\u508D\u70B9\u3092\u633F\u5165",command_remove_novel_ruby:"\u9078\u629E\u7BC4\u56F2\u304B\u3089\u30EB\u30D3\u3092\u524A\u9664",ruby_insert_modal_title:"\u30EB\u30D3\u3092\u633F\u5165",ruby_insert_modal_body:"\u672C\u6587",ruby_insert_modal_ruby:"\u30EB\u30D3",ruby_insert_modal_ok:"OK",notice_insert_novel_dot_no_selection:"\u5148\u306B\u508D\u70B9\u3092\u632F\u308A\u305F\u3044\u672C\u6587\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",settings_command_title:"\u30B3\u30DE\u30F3\u30C9",settings_support_title:"\u30B5\u30DD\u30FC\u30C8",settings_source_mode_render_name:"\u30BD\u30FC\u30B9\u30E2\u30FC\u30C9\u3067\u30EB\u30D3\u3092\u8868\u793A",settings_source_mode_render_desc:"\u30BD\u30FC\u30B9\u30E2\u30FC\u30C9\u3067\u306F\u30EB\u30D3\u8A18\u53F7\u3092\u5165\u529B\u3057\u305F\u307E\u307E\u306E\u6587\u5B57\u3068\u3057\u3066\u8868\u793A\u3057\u305F\u3044\u5834\u5408\u3001\u30AA\u30D5\u306B\u3057\u3066\u304F\u3060\u3055\u3044",settings_insert_full_width_separator_name:'\u300C\u30EB\u30D3\u3092\u633F\u5165\u300D\u30B3\u30DE\u30F3\u30C9\u3067\u5168\u89D2\u306E "\uFF5C" \u3092\u4F7F\u3046',settings_insert_full_width_separator_desc:'\u30B3\u30DE\u30F3\u30C9\u3067\u534A\u89D2\u306E "|" \u3092\u633F\u5165\u3057\u305F\u3044\u5834\u5408\u3001\u30AA\u30D5\u306B\u3057\u3066\u304F\u3060\u3055\u3044\u3000\u203B\u8868\u793A\u306B\u306F\u5F71\u97FF\u3057\u307E\u305B\u3093',settings_emphashis_dot_name:"\u508D\u70B9\u306E\u6587\u5B57",settings_emphashis_dot_desc:"\u300C\u508D\u70B9\u3092\u633F\u5165\u300D\u30B3\u30DE\u30F3\u30C9\u3067\u633F\u5165\u3059\u308B\u6587\u5B57\u3092\u6307\u5B9A\u3057\u307E\u3059\u30021\u6587\u5B57\u76EE\u3057\u304B\u4FDD\u5B58\u3055\u308C\u307E\u305B\u3093",settings_donate_name:"\u5BC4\u4ED8",settings_donate_desc:"\u3053\u306E\u30D7\u30E9\u30B0\u30A4\u30F3\u3092\u6C17\u306B\u5165\u3063\u305F\u3089\u3001\u958B\u767A\u652F\u63F4\u306E\u305F\u3081\u306E\u5BC4\u4ED8\u3092\u8003\u3048\u3066\u3044\u305F\u3060\u3051\u308B\u3068\u5B09\u3057\u3044\u3067\u3059",settings_donate_button:"\u304A\u306B\u304E\u308A\u3044\u3063\u3053\u304A\u3054\u308B"};var L={en:E,ja:A},R=L[M.moment.locale()];function r(n){return R||console.error("Error: dictionary locale not found",M.moment.locale()),R&&R[n]||E[n]}var y=class extends c.PluginSettingTab{constructor(e,o){super(e,o);this.plugin=o}display(){let{containerEl:e}=this;e.empty(),new c.Setting(e).setName(r("settings_source_mode_render_name")).setDesc(r("settings_source_mode_render_desc")).addToggle(o=>o.setValue(this.plugin.settings.sourceModeRendering).onChange(async t=>{this.plugin.settings.sourceModeRendering=t,await this.plugin.saveSettings()})),new c.Setting(e).setName(r("settings_command_title")).setHeading(),new c.Setting(e).setName(r("settings_insert_full_width_separator_name")).setDesc(r("settings_insert_full_width_separator_desc")).addToggle(o=>o.setValue(this.plugin.settings.insertFullWidthMark).onChange(async t=>{this.plugin.settings.insertFullWidthMark=t,await this.plugin.saveSettings()})),new c.Setting(e).setName(r("settings_emphashis_dot_name")).setDesc(r("settings_emphashis_dot_desc")).addText(o=>o.setValue(this.plugin.settings.emphasisDot).onChange(async t=>{this.plugin.settings.emphasisDot=t[0],await this.plugin.saveSettings()})),new c.Setting(e).setName(r("settings_support_title")).setHeading(),new c.Setting(e).setName(r("settings_donate_name")).setDesc(r("settings_donate_desc")).addButton(o=>o.setButtonText(r("settings_donate_button")).setCta().onClick(()=>{setTimeout(()=>location.replace("https://buymeacoffee.com/quels"),0)}))}};var m=/(?:(?:[|｜]?(?<body1>[一-龠]+?))|(?:[|｜](?<body2>[^|｜]+?)))《(?<ruby>.+?)》/gm,X={sourceModeRendering:!0,insertFullWidthMark:!0,emphasisDot:"\u30FB"},b=class extends l.Plugin{constructor(){super(...arguments);this.rubyPostProcessor=D}async onload(){await this.loadSettings(),this.registerMarkdownPostProcessor(this.rubyPostProcessor),this.registerEditorExtension(N(this.app,this)),this.addCommand({id:"novel-ruby-insert",name:r("command_insert_novel_ruby"),editorCallback:(e,o)=>{let t=P(e.getSelection());new f(this.app,t,(d,i)=>{let a=this.settings.insertFullWidthMark?"\uFF5C":"|";e.replaceSelection(a+d+"\u300A"+i+"\u300B")}).open()}}),this.addCommand({id:"novel-ruby-insert-dot",name:r("command_insert_novel_dot"),editorCallback:(e,o)=>{let t=e.getSelection();if(t=="")new l.Notice(r("notice_insert_novel_dot_no_selection"),2e3);else{let d="",i=this.settings.insertFullWidthMark?"\uFF5C":"|";t=P(t);for(let a=0;a<t.length;a++)d+=i+t[a]+"\u300A"+this.settings.emphasisDot[0]+"\u300B";e.replaceSelection(d)}}}),this.addCommand({id:"novel-ruby-remove",name:r("command_remove_novel_ruby"),editorCallback:(e,o)=>{e.replaceSelection(P(e.getSelection()))}}),this.addSettingTab(new y(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},X,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.app.workspace.updateOptions()}};function P(n){var o;let s=n,e=Array.from(n.matchAll(m));for(let t of e){let d=(o=t.groups)!=null&&o.body1?t.groups.body1:t.groups.body2;s=s.replace(t[0],d)}return s}var f=class extends l.Modal{constructor(e,o,t){super(e);this.onSubmit=t,this.body=o}onOpen(){let{contentEl:e}=this;e.createEl("h1",{text:r("ruby_insert_modal_title")}),new l.Setting(e).setName(r("ruby_insert_modal_body")).addText(o=>o.setValue(this.body).onChange(t=>{this.body=t})),new l.Setting(e).setName(r("ruby_insert_modal_ruby")).addText(o=>o.onChange(t=>{this.ruby=t})),new l.Setting(e).addButton(o=>o.setButtonText(r("ruby_insert_modal_ok")).setCta().onClick(()=>{this.close(),this.onSubmit(this.body,this.ruby)}))}onClose(){let{contentEl:e}=this;e.empty()}};

/* nosourcemap */